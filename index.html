<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Tukar Wajah</title>
    <!-- Tailwind CSS CDN untuk styling yang cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .spinner {
            border-top-color: #6366f1;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <div class="container mx-auto max-w-4xl bg-white p-8 rounded-2xl shadow-xl my-10">
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-6">
            Aplikasi Tukar Wajah
        </h1>
        <p class="text-center text-gray-600 mb-8">
            Unggah gambar sumber, gambar target, dan biarkan AI melakukan pertukaran wajah.
        </p>

        <!-- Area Unggah Gambar -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- Unggah Gambar Sumber -->
            <div class="flex flex-col items-center">
                <label for="imageSource" class="block text-lg font-semibold text-gray-700 mb-4 cursor-pointer">
                    Gambar Sumber (Wajah yang Akan Digunakan)
                    <div id="previewSource" class="mt-2 w-full h-64 border-4 border-dashed border-gray-300 rounded-xl flex items-center justify-center overflow-hidden bg-gray-50 hover:bg-gray-100 transition-colors duration-200">
                        <span class="text-gray-400">Pilih gambar</span>
                    </div>
                </label>
                <input type="file" id="imageSource" accept="image/*" class="hidden">
            </div>

            <!-- Unggah Gambar Target -->
            <div class="flex flex-col items-center">
                <label for="imageTarget" class="block text-lg font-semibold text-gray-700 mb-4 cursor-pointer">
                    Gambar Target (Wajah yang Akan Diganti)
                    <div id="previewTarget" class="mt-2 w-full h-64 border-4 border-dashed border-gray-300 rounded-xl flex items-center justify-center overflow-hidden bg-gray-50 hover:bg-gray-100 transition-colors duration-200">
                        <span class="text-gray-400">Pilih gambar</span>
                    </div>
                </label>
                <input type="file" id="imageTarget" accept="image/*" class="hidden">
            </div>
        </div>

        <!-- Tombol dan Indikator Pemuatan -->
        <div class="flex justify-center mb-8">
            <button id="generateBtn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-indigo-700 transition-transform duration-200 transform hover:scale-105 disabled:bg-indigo-300 disabled:cursor-not-allowed">
                Tukar Wajah
            </button>
        </div>

        <div id="loading" class="hidden flex justify-center items-center mb-8">
            <div class="spinner w-8 h-8 rounded-full border-4 border-gray-300"></div>
            <span class="ml-4 text-lg text-gray-600">Sedang membuat...</span>
        </div>

        <!-- Area Hasil -->
        <div id="result-container" class="mt-8 hidden flex flex-col items-center">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Hasil</h2>
            <img id="resultImage" alt="Hasil Tukar Wajah" class="w-full h-auto max-h-[500px] object-contain rounded-xl shadow-md">
            <div id="error-message" class="mt-4 text-red-500 font-medium hidden"></div>
        </div>
    </div>

    <script>
window.onload = function() {
    // Referensi ke elemen-elemen HTML.
    const imageSourceInput = document.getElementById('imageSource');
    const imageTargetInput = document.getElementById('imageTarget');
    const previewSource = document.getElementById('previewSource');
    const previewTarget = document.getElementById('previewTarget');
    const generateBtn = document.getElementById('generateBtn');
    const loadingIndicator = document.getElementById('loading');
    const resultContainer = document.getElementById('result-container');
    const resultImage = document.getElementById('resultImage');
    const errorMessage = document.getElementById('error-message');

    // GANTI DENGAN API KEY ANDA DARI LAYANAN WAJAH.AI DI SINI
    // Contoh: const apiKey = "sk-1234567890abcdef";
    const apiKey = "87fe039ed22176ad73b217f040ce352538f539ed062dd399d529aa9fe0754bbe"; 

    // Fungsi untuk menampilkan pratinjau gambar yang diunggah.
    const handleFileChange = (e, previewElement) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                previewElement.innerHTML = `<img src="${reader.result}" alt="Preview" class="object-cover w-full h-full">`;
            };
            reader.readAsDataURL(file);
        }
    };

    // Fungsi utama untuk memanggil API face swap.
    const handleGenerate = async () => {
        if (!imageSourceInput.files[0] || !imageTargetInput.files[0]) {
            alert('Silakan unggah kedua gambar.');
            return;
        }

        if (!apiKey) {
            alert('Silakan masukkan API key Anda.');
            return;
        }

        generateBtn.disabled = true;
        loadingIndicator.classList.remove('hidden');
        resultContainer.classList.add('hidden');
        errorMessage.classList.add('hidden');

        try {
            // Persiapan data form untuk mengirim gambar ke API.
            const formData = new FormData();
            formData.append('source_image', imageSourceInput.files[0]);
            formData.append('target_image', imageTargetInput.files[0]);

            // URL API (Ini adalah contoh URL, sesuaikan dengan API yang Anda gunakan)
            const apiUrl = 'https://api.wajah.ai/v1/face-swap';

            // Panggil API dengan metode POST.
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}` // Menggunakan bearer token untuk otentikasi
                },
                body: formData
            });

            // Cek apakah responsnya berhasil
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Gagal memanggil API.');
            }

            const result = await response.json();

            if (result.image_url) {
                // Tampilkan gambar hasil dari URL yang diberikan API
                resultImage.src = result.image_url;
                resultContainer.classList.remove('hidden');
            } else {
                throw new Error('Respons API tidak valid atau tidak memiliki URL gambar.');
            }

        } catch (error) {
            console.error("Panggilan API gagal:", error);
            errorMessage.textContent = `Terjadi kesalahan: ${error.message}`;
            errorMessage.classList.remove('hidden');
            resultContainer.classList.remove('hidden');
        } finally {
            loadingIndicator.classList.add('hidden');
            generateBtn.disabled = false;
        }
    };

    // Tambahkan event listener.
    imageSourceInput.addEventListener('change', (e) => handleFileChange(e, previewSource));
    imageTargetInput.addEventListener('change', (e) => handleFileChange(e, previewTarget));
    generateBtn.addEventListener('click', handleGenerate);
};
    </script>
</body>
</html>
